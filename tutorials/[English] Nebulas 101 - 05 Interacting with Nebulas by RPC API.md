# Nebulas 101 - 05 Interacting with Nebulas by RPC API

Nebulas chain node can be accessed remotely through RPC remote control. Nebulas chain provides a series of APIs to get node information, account balances, send transactions and deploy calls to smart contracts.

The remote access to the Nebulas chain is done by [gRPC](https://grpc.io),via the proxy ([grpc-gateway](https://github.com/grpc-ecosystem/grpc-gateway)) HTTP access. HTTP access is a RESTful interface, with the same arguments as the gRPC call interface.

## gRPC access
gRPC is a high-performance, generic open-source RPC framework developed by Google primarily for mobile applications and designed based on the HTTP/ 2 protocol standard, based on [ProtoBuf](https://github.com/google/protobuf) serialization protocol development, And supports many development languages.

The gRPC interface for Nebulas chain was developedusing go language and provides a client written in go language [demo](https://github.com/nebulasio/go-nebulas/blob/develop/rpc/testing/client/main.go). Here mainly introduces the use of g to achieve gRPC interface.(GRPC supports multiple languages, or gRPC can be accessed in other languages.)

gRPC defines the serviceusing ProtoBuf, which is defined in the official code at [/rpc/pb](https://github.com/nebulasio/go-nebulas/tree/master/rpc/pb):

```
// API interface, defines the node, account address information acquisition, send transactions and other interfaces
api_rpc.proto

```
Use `make` in` rpc/ pb` folder when using:

```
cd rpc/ pb
make
```
Generate the corresponding go version of the grpc interface code. Go version of the official code has been generated, the use of time can not be re-generated. The gRPC port can be modified in the configuration file(eg: `conf/ default/ seed.conf`). Configuration items in the port configuration items are as follows:

```
# Service configuration of interaction between user and node, when multiple ports are started on the same machine, pay attention to modify the port to prevent occupancy
rpc {
    # gRPC API service port
    rpc_listen: ["127.0.0.1:8684"]
    # HTTP API service port
    http_listen: ["127.0.0.1:8685"]
    # Open module that can provide http service to outside
    http_module: ["api", "admin"]
}
```
The default configuration port is the above `API: 51510`.

go gRPC access code is as follows:

```go
// gRPC server connection address configuration
addr: = fmt.Sprintf("127.0.0.1:%d",uint32(8684))
conn, err: = grpc.Dial(addr, grpc.WithInsecure())
if err! = nil {
log.Warn("rpc.Dial() failed:", err)
}
defer conn.Close()

// API interface to access node status information
api: = rpcpb.NewAPIServiceClient(conn)
resp, err: = ac.GetNebState(context.Background(), & rpcpb.GetNebStateRequest {})
if err! = nil {
log.Println("GetNebState", "failed", err)
} else {
// tail: = r.GetTail()
log.Println("GetNebState tail", resp)
}

// API interface to access, lock account address
management: = rpcpb.NewManagementServiceClient(conn)
from: = "8a209cec02cbeab7e2f74ad969d2dfe8dd24416aa65589bf"
resp, err = management.LockAccount(context.Background(), & rpcpb.LockAccountRequest {Address: from})
if err! = nil {
log.Println("LockAccount", from, "failed", err)
} else {
log.Println("LockAccount", from, "result", resp)
}
```
API interface defined in the go interface file generated by the proto file:
`api_rpc.pb.go`

## HTTP access
Nebulas chain HTTP access using RESTful style API. Using the HTTP interface, you can easily access node information, account address balance, send transactions and deploy calls to smart contracts.

Official default port:

*8685: The default API port to access the [RPC](https://github.com/nebulasio/wiki/blob/master/rpc.md) interface, get node information, send transactions, etc .; can be external users.

Some examples of using the HTTP access interface:

##### Get node information
Return node information.

Protocol | Method | API |
| ---------- | -------- | ----- |
| HTTP | GET |/v1/user/nodeinfo |

###### Parameters
none

###### Returns
`id` node ID.

`chain_id` Blockchain ID.

`version` node version.

`peer_count` The number of currently connected nodes.

`synchronized` node synchronization status.

`bucket_size` node routing table to save the number of nodes.

`relay_cache_size` broadcast buffer size.

`stream_store_size` node stream data warehouse size.

`stream_store_extend_size` node stream data warehouse extension size.

`protocol_version` Network protocol version.

`route_table` routing table

```
message RouteTable {
string id = 1;
repeated string address = 2;
}
```

###### HTTP Example
```
// Request
curl -i -H Accept: application/ json -X GET http://localhost:8685/v1/user/nodeinfo

// Result
{
    "id": "QmPyr4ZbDmwF1nWxymTktdzspcBFPL6X1v3Q5nT7PGNtUN",
    "chain_id": 100,
    "version": 1,
    "bucket_size": 16,
    "relay_cache_size": 65536,
    "stream_store_size": 128,
    "stream_store_extend_size": 32,
    "protocol_version": "/ neb/ 1.0.0"
}
```
##### Account List
Returns the list of accounts associated with the node.

Protocol | Method | API |
| ---------- | -------- | ----- |
| HTTP | GET |/v1/user/accounts |

##### Parameters
none

##### Returns
`addresses` account list

##### HTTP Example
```
// Request
curl -i -H Accept: application/ json -X GET http://localhost:8685/v1/user/accounts

// Result
{
    "addresses": [
        "16464b93292d7c99099d4d982a05140f12779f5e299d6eb4",
        "22ac3a9a2b1c31b7a9084e46eae16e761f83f02324092b09",
        "5cdadc1cfe3da0a3d067e9f1b195b90c5aebfb5afc8d43b4",
        "8a209cec02cbeab7e2f74ad969d2dfe8dd24416aa65589bf"
    ]
}
```
#### Get Account Information
Returns account information, including account address balance and current transaction nonce.

Protocol | Method | API |
| ---------- | -------- | ----- |
| HTTP | POST |/v1/user/accountstate |

###### Parameters
`address` account address hash.

###### Returns
`balance` current balance Unit: 1/(10 ^ 18) nas.

nonce current transaction nonce.

###### HTTP Example
```
// Request
curl -i -H Accept: application/ json -X POST http://localhost:8685/v1/user/accountstate -d '{"address": "22ac3a9a2b1c31b7a9084e46eae16e761f83f02324092b09"}'

// Result
{
    "balance": "5",
    "nonce": "0"
}
```
####unlock account
Use password to unlock account.

Protocol | Method | API |
| ---------- | -------- | ----- |
| HTTP | POST |/v1/ admin/account/unlock |


###### Parameters
`address` account address hash.

`passphrase` account password.

###### Returns
`result` unlock results.

###### HTTP Example
```
// Request
curl -i -H Accept: application/ json -X POST http://localhost:8685/v1/admin/account/unlock -d '{"address": "8a209cec02cbeab7e2f74ad969d2dfe8dd24416aa65589bf", "passphrase": "passphrase"}'

// Result
{
    "result": true
}

```
#### Send the transaction
Send the transaction, submit the contract interface

Protocol | Method | API |
| ---------- | -------- | ----- |
| HTTP | POST |/v1/user/transaction |

###### Parameters
`from` instigator account address hash.

`to` recipient account address hash.

`value` Amount,unit 1/(10 ^ 18) nas.

nonce transaction nonce.

`gasPrice` trading gas price.

`gasLimit` trading gas cap.

contract information, release and invoke smart contracts.

###### Returns
`txhash` transaction hash;

If the contract is deployed, returns the contract address information:

contract_address contract address information;

###### Example
```
// Request
curl -i -H 'Accept: application/ json' -X POST http://localhost:8685/v1/user/transaction -H 'Content-Type: application/ json' -d '{"from": "1a263547d167c74cf4b8f9166cfa244de0481c514a45aa2c", "to": "333cb3ed8c417971845382ede3cf67a0a96270c05fe2f700", "value": "1000000000000000000", "nonce": 1, "gasPrice": "1000000", "gasLimit": "2000000"} '

// Result
{
    "txhash": "cc7133643a9ae90ec9fa222871b85349ccb6f04452b835851280285ed72b008c"
}
```

#### Get transaction information
Transaction information returned by transaction hash.

Protocol | Method | API |
| ---------- | -------- | ----- |
| HTTP | POST |/v1/user/getTransactionReceipt |

###### Parameters
`hash` transaction hash.

###### Returns
`hash` transaction hash.

`from` Instigator account address hash.

`to` recipient account address hash.

nonce transaction nonce.

`timestamp` transaction timestamp.

`data` transaction data.

`chainId` transaction chain ID.

contract_address contract address.

###### HTTP Example
```
// Request
curl -i -H Accept: application/ json -X POST http://localhost:8685/v1/user/getTransactionReceipt -d '{"hash": "f37acdf93004f7a3d72f1b7f6e56e70a066182d85c186777a2ad3746b01c3b52"}'

// Result
{
    "hash": "f37acdf93004f7a3d72f1b7f6e56e70a066182d85c186777a2ad3746b01c3b52",
    "from": "8a209cec02cbeab7e2f74ad969d2dfe8dd24416aa65589bf",
    "to": "22ac3a9a2b1c31b7a9084e46eae16e761f83f02324092b09",
    "nonce": "12",
    "timestamp": "1511519091",
    "chainId": 1
}
```


For detailed interface usage and parameter definitions, refer to the official documentation:
- [RPC](https://github.com/nebulasio/wiki/blob/master/rpc.md)
- [Admin RPC](https://github.com/nebulasio/wiki/blob/master/rpc_admin.md).

### Next step: Tutorial 6:

 [Connecting to Testnet](https://github.com/nebulasio/wiki/blob/master/tutorials/%5BEnglish%5D%20Nebulas%20101%20-%2006%20Testnet.md)
